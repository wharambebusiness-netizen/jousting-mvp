<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Orchestrator â€” Operator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="stylesheet" href="/style.css">
  <script src="https://unpkg.com/htmx.org@2.0.4/dist/htmx.min.js"></script>
</head>
<body hx-boost="true">
  <div class="htmx-progress" id="progress-bar"></div>

  <nav class="nav">
    <a href="/" class="nav__brand">Operator</a>
    <ul class="nav__links">
      <li><a href="/" class="nav__link">Dashboard</a></li>
      <li><a href="/orchestrator" class="nav__link nav__link--active">Orchestrator</a></li>
    </ul>
  </nav>

  <main class="page">
    <div class="page-header">
      <h1>Orchestrator</h1>
    </div>

    <!-- Mission Launcher -->
    <div class="section">
      <p class="section__title">Launch Mission</p>
      <div id="mission-launcher"
           hx-get="/views/mission-launcher"
           hx-trigger="load"
           hx-swap="innerHTML">
        <div class="skeleton" style="height:60px"></div>
      </div>
    </div>

    <!-- Status -->
    <div class="section">
      <p class="section__title">Status</p>
      <div id="orch-content"
           hx-get="/views/orch-status"
           hx-trigger="load, every 3s"
           hx-swap="innerHTML">
        <div class="skeleton" style="height:32px;width:240px;margin-bottom:16px"></div>
        <div class="skeleton" style="height:16px;width:60%;margin-bottom:24px"></div>
        <div class="agent-grid">
          <div class="agent-card"><div class="skeleton" style="height:60px"></div></div>
          <div class="agent-card"><div class="skeleton" style="height:60px"></div></div>
          <div class="agent-card"><div class="skeleton" style="height:60px"></div></div>
        </div>
      </div>
    </div>
  </main>

  <div id="toast-container"></div>

  <script>
    document.body.addEventListener('htmx:beforeRequest', function() {
      document.getElementById('progress-bar').classList.add('active');
      document.getElementById('progress-bar').classList.remove('done');
    });
    document.body.addEventListener('htmx:afterRequest', function() {
      var bar = document.getElementById('progress-bar');
      bar.classList.remove('active');
      bar.classList.add('done');
      setTimeout(function() { bar.classList.remove('done'); bar.style.width = ''; }, 400);
    });

    // Toast helper for mission start feedback
    function showToast(msg, type) {
      var container = document.getElementById('toast-container');
      var toast = document.createElement('div');
      toast.className = 'toast toast--' + (type || 'info');
      toast.textContent = msg;
      container.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 4000);
    }

    // Handle mission start response
    document.body.addEventListener('htmx:afterRequest', function(evt) {
      if (evt.detail.pathInfo && evt.detail.pathInfo.requestPath === '/api/orchestrator/start') {
        if (evt.detail.successful) {
          showToast('Orchestrator started successfully', 'success');
        } else {
          try {
            var err = JSON.parse(evt.detail.xhr.responseText);
            showToast(err.error || 'Failed to start', 'error');
          } catch (_) {
            showToast('Failed to start orchestrator', 'error');
          }
        }
      }
    });
  </script>
</body>
</html>
