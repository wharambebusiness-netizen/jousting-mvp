# Session History

Compact table of all sessions. For full details, see `docs/archive/jousting-handoff-sNN.md`.

| Session | Summary |
|---------|---------|
| S5 | Balance scaling system with soft cap, fatigue thresholds, partial guard fatigue |
| S6 | Melee pacing rebalance, changed criticals to 2 wins, dev onboarding docs |
| S7 | Gigaverse research deep-dive, 5 memory files created, API mapping |
| S8 | Verified API endpoints, discovered blanket auth on /api/game/* namespace |
| S9 | Found official Gigaverse-Games/play repo, probed ~150 non-game paths |
| S10 | Public gigling metadata endpoint discovery via RPC, trait sampling |
| S11 | Gigling hatch rate tables, gear system design, 31 tests added |
| S12 | Caparison effects implemented, 6 gear factory functions, 53 new tests |
| S13 | Loadout UI screen, 10-screen App.tsx state machine, rebalanced gear/rarity |
| S14 | System logic audit passed, caparison UI display, AI opponent enhancements |
| S15 | Combat logic review, fixed counter table, Precision Thrust, Charger/Breaker STA |
| S16 | Deployed to GitHub Pages, comprehensive 65-test playtest suite |
| S17 | Full system review, doc drift fixes, production-ready status confirmed |
| S18 | Multi-agent orchestrator system created, Node.js headless Claude coordination |
| S19 | Orchestrator review, Windows process kill fix, continuation system, stretch goals |
| S20 | App integration, counter bonus display fix, 12-slot gear system overhaul |
| S21 | Orchestrator v3 infrastructure, CLAUDE.md, 5 slash commands, mission configs |
| S22 | Balance pass: Charger CTL +5, Technician MOM +5, guardImpactCoeff tuned |
| S23 | Strategic planning, type system additions, 5-agent deep analysis completed |
| S24 | Phase 0 cleanup, gear variants system, melee rebalance with carryover divisors |
| S25 | Uncommon rarity bonus 1→2, opponent archetype selector, per-slot variant toggles |
| S26 | Orchestrator v4 with backlog system, 9 professional roles, overnight runner |
| S27 | Seeded backlog tasks, updated CLAUDE.md, fixed orchestrator reliability issues |
| S28 | Overnight Run #1: 8 rounds, 477→699 tests, balance changes, CSS polish |
| S29 | Fixed 8 stale test assertions, designed Agent System v5 plan (not implemented) |
| S30 | Planning only, multi-agent research, expanded v5 plan to 7 phases |
| S31 | Implemented entire Agent System v5: 7 phases, orchestrator hardening, resilience |
| S32 | Research + planning, cost tracking decision, 8-phase master plan created |
| S33 | Phase 1+Phase 5 complete: cost tracking, model escalation, mission hot-reload |
| S34 | Orchestrator audit, backlog fix, seeded 6 new tasks for overnight Run #2 |
| S35 | Launched Overnight Run #2, Round 1 complete (7 agents, orchestrator v6.1) |
| S36 | Post-Run #2 analysis, orchestrator v6.1 improvements, Phase 4 planning |
| S37 | Run #2 21 rounds in 4 hours, +75 tests, work-gating proven, round scoping bug |
| S38 | MVP at 100%: ImpactBreakdown UI, 908 tests passing, deployed and pushed |
| S39 | Orchestrator focus shift to balance tuning, 8-item roadmap for automation |
| S40 | Phase 1 data layer: simulate.ts --json, orchestrator sim runner, balance tracking |
| S41 | Phase 2 intelligence: regression detection, convergence criteria, balance context |
| S42 | Phase 3 agent layer: balance backlog generation, updated role templates |
| S43 | Phase 4 complete: param-search.ts CLI tool with sweep/descent strategies |
| S44 | Param search hardening: baseline averaging, noise floor, reliability annotations |
| S45 | Coordinate descent tuning: 5 params optimized, giga tier near-perfect 3.1pp |
| S46 | guardImpactCoeff tuned 0.18→0.12, --matches CLI flag, bare tier improved |
| S47 | Orchestrator v8: backlog priority sorting, smart revert, multi-mission sequencing |
| S48 | Orchestrator v9: streaming agent pool, pipelined sims, 24% faster per round |
| S49 | Orchestrator v10: adaptive timeouts, multi-round lookahead, incremental testing |
| S51 | Orchestrator v14: agent effectiveness tracking, dynamic concurrency, quality reports |
| S52 | Orchestrator v15: priority scheduling, task decomposition, live dashboard |
| S53 | simulate.ts enhancements: archetype overrides, multi-tier summary, +251 lines |
| S54 | Session continuity, delta prompts, inline context injection for handoff carryover |
| S55 | Unified agent pool, cost budget enforcement, stale session invalidation |
| S56 | Early test start, all-done exit code 42, overnight runner v8 improvements |
| S57 | General-purpose expansion: project-detect, role-registry, quality-gates, 6 new roles |
| S58 | Config-driven test pipeline, dynamic ownership, project-config.json integration |
| S59 | Git worktree isolation, dynamic agent spawning, workflow-engine composable patterns |
| S60 | Phase 4 ecosystem started: SDK adapter, observability, DAG scheduler (not integrated) |
| S61 | Phase 4 complete: project-scaffold 7 templates, plugin-system 6 types, all integrated |
| S62 | Comprehensive developer guide created, project documentation complete |
| S63 | Infrastructure overhaul: docs split into 6 files, CLAUDE.md 301→89 lines, orchestrator.mjs 5213→3421 lines (3 modules extracted) |
| S65 | Orchestrator v23: 5 more modules extracted (3421→2718 lines, 10→15 modules), stale artifact cleanup, log rotation |
| S68 | Orchestrator reliability plan: 8-milestone plan from autonomous agent lessons analysis, deep code audit by 5 agents |
| S69 | Reliability M1-M5: failure context injection, output cross-verification, file pre-flight, cross-session lessons, notification plugin |
| S70 | Reliability M6-M8 COMPLETE: env sanitization, self-review role, checkpoint/resume. M1 bug fix. All 8 milestones done. v27 |
| S71 | Audit session: verified no damage from crashed session, 4-agent infrastructure investigation, documented agent communication channels and module health |
| S72 | First orchestrator test coverage: 215 tests across 8 modules, extracted parseMetaContent pure function, fixed multiline files-modified regex bug. 908→1123 tests, 8→16 suites |
| S73 | Orchestrator v28: --dry-run smoke test mode (mock agents/tests/git), mission config validation (43 tests), getDynamicConcurrency edge case fix. 1123→1186 tests, 16→18 suites |
| S74 | Dry-run integration tests (subprocess e2e), multi-hop cycle detection (Kahn's), balanceConfig schema validation, dry-run presets (--dry-run=chaos/regression), CLI module guard fixes. 1186→1218 tests, 18→19 suites |
| S75 | Orchestrator v29, critical agent pool async bugfix (runAgentPool was async but called without await — agents never properly awaited between rounds), handoff test isolation via ORCH_HANDOFF_DIR env var, coord agent lifecycle test. 1218→1219 tests |
| S76 | Planning: Operator UI system design. 3 review agents (tech feasibility, UX/workflow, Claude Code capabilities). Revised 6-milestone plan: M1 walking skeleton (Agent SDK + auto-continuation CLI), M2 robust session mgmt, M3 agent self-continuation, M4 HTTP API, M5 web UI dashboard, M6 orchestrator mgmt + git. Key decisions: Agent SDK over CLI spawning, build on existing modules, server-rendered HTML over React SPA, cut multi-orchestrator milestone. No code changes. |
| S77 | M1 Walking Skeleton: Installed Agent SDK (v0.2.44), created operator/ directory, built operator.mjs CLI daemon with session chain runner. Features: SDK query() integration, PreCompact hook for context monitoring, handoff parsing from agent output, auto-commit between sessions, chain logging. Tested with 2-turn and 3-turn limits — continuation loop works end-to-end across multiple sessions. |
| S78 | Planning: Reviewed S76 operator milestone plan for technical soundness. Created `docs/operator-plan.md` — comprehensive architecture doc for M2-M6 with schemas, implementation notes, delegation guides. Key revisions: auto-push moved from M6 to M2, M3 requires design spike first, M5 scoped to read-only MVP, process supervision addressed in M2. |
| S79 | Operator M2: Built robust session management. Created registry.mjs (chain persistence with atomic writes, CRUD, archival), errors.mjs (error classification for thrown + in-band SDK errors, retry with backoff, circuit breaker, handoff validation). Rewrote operator.mjs with all M2 features: --resume, --max-budget-usd, --project-dir, --auto-push, --notify-webhook, error recovery, handoff validation+retry. Multi-project ready via --project-dir flag + projectDir in registry. 51 new tests. 1219→1270 tests, 19→21 suites. |
| S80 | Operator M3: Agent self-continuation. Design spike resolved interaction between operator-level and orchestrator-level continuation (they operate at different levels, no conflict). Added runAgentWithContinuation() to sdk-adapter.mjs — wraps runAgentViaSDK() with PreCompact hook, handoff parsing, cost guardrails ($2 default, max 3 continuations). Wired into agent-runner.mjs (conditional SDK path when useSDK=true). Added recordContinuation() to agent-tracking.mjs. New config: maxAgentContinuations, maxAgentChainCostUsd, maxAgentTurns. 28 new tests. 1270→1298 tests, 21→22 suites. |
| S81 | Operator M4: HTTP API layer. Express + WebSocket server (server.mjs, routes/chains.mjs, routes/orchestrator.mjs, ws.mjs). 8 REST endpoints (chain CRUD, costs, projects, orchestrator status/control) + WebSocket event bridge with pattern subscriptions. Multi-project filtering, pagination, CORS. 3 parallel review agents found 8 bugs (WeakMap leak, pagination, req.body crash, signal handlers, etc) — all fixed. 50 new server tests including WS integration with message queue pattern. 1298→1348 tests, 22→23 suites. |
| S82 | Two phases. Phase 1: 3 parallel review agents audited M1-M3 code, found 16 bugs/risks. Fixed 8 bugs: shell injection in git commit (spawn with array args), handoff name collision (chain ID prefix), per-session budget (remaining not total), success always true in continuation, SIGINT/SIGTERM graceful shutdown, orphaned tmp cleanup, NaN budget fallback, original prompt in continuation. 22 new edge case tests. Phase 2: M5 Web UI Dashboard — 3 pages (dashboard, chain detail, orchestrator) with Pico CSS dark mode + HTMX polling. Server-rendered HTML fragments, session timeline, cost breakdown bars, agent cards, quick-start form. 38 view tests. 1348→1408 tests, 23→24 suites. |
| S83 | M6 kickoff. Phase 1: Added web design skills — researched modern dashboard UI patterns, created memory/web-design.md (29-section design reference) and memory/ui-upgrade-plan.md (gap analysis). Phase 2: Surveyed M6 scope (3 parallel agents: M6 spec, existing routes, missions/reports/git-ops). Created 8-task M6 plan. Phase 3: Rewrote operator/public/style.css with professional design token system — Linear/Vercel-inspired dark palette, CSS custom properties, sticky glassmorphism nav, metric cards, semantic status dots/badges, skeleton loading, toast notifications, HTMX transitions, progress bar, breadcrumbs, responsive breakpoints. 212→527 lines CSS. Tests unchanged: 1408 tests, 24 suites. |
| S84 | M6 complete. Step 1: Updated all 3 HTML pages (index, chain, orchestrator) — new glassmorphism nav, .page layout, toast container, progress bar JS, hx-boost, skeleton loading. Step 2: Migrated all view renderer class names — dot→status-dot, badge→badge--variant, timeline-block→timeline__segment, btn-kill→btn btn--danger, stat-card→metric-card, empty-msg→empty-state. Step 3 (M6a): Built mission launcher — GET /api/orchestrator/missions lists JSON configs, POST /api/orchestrator/start forks orchestrator via child_process, mission launcher form with dry-run toggle. Step 4 (M6d): Built git integration — operator/routes/git.mjs with status/push/commit/PR endpoints, git status panel on dashboard with HTMX polling. Updated 5 test assertions for new class names, added 7 new tests for M6 features. 1408→1415 tests, 24 suites. |
| S85 | Three features. (1) Report Viewer (M6b): GET /api/orchestrator/reports + /reports/:file endpoints, /views/report-viewer HTMX fragment with tab-based file switching, markdown rendering via marked CDN. (2) Live Log Streaming: orchestrator:log bridged to WebSocket, log panel on orchestrator page with auto-scroll, clear, 500-line buffer, stderr highlighting, auto-reconnect. (3) Chain Restart: POST /api/chains/:id/restart creates new chain from failed/aborted original, restart buttons on chain rows and detail page. 15 new tests. 1415→1430 tests, 24 suites. |
| S86 | React frontend polish. Fixed 3 bugs: melee win dots showed 3 instead of 4 (AttackSelect + MeleeResult), player labels P1/P2/Opp → You/Opponent for consistency, unseat check excluded 'none' value in MeleeTransitionScreen. Deleted dead MeleeTransition.tsx. Comprehensive 15-component audit identified remaining polish items (reveal animation, hardcoded colors, code duplication). Tests unchanged: 1430 tests, 24 suites. |
| S87 | React frontend polish continued. (1) Dramatic reveal animation: RevealScreen now has 3-phase staged reveal — player attack shows immediately, opponent card flips after 0.8s via CSS 3D perspective transform, counters and action buttons fade in at 1.6s. (2) CounterChart hardcoded colors: replaced #2ECC71/#E74C3C with --counter-win-border/--counter-lose-border design tokens. (3) STAT_TIPS consolidation: exported shared STAT_TIPS from helpers.tsx, removed duplicate from LoadoutScreen.tsx. Tests unchanged: 1430 tests, 24 suites. |
| S88 | React code cleanup + feature polish. (1) Removed 189 lines dead CSS (triangle/matrix/text chart styles and old responsive queries). (2) Replaced 12 hardcoded rgba() values with new stance design tokens (--stance-*-light, --stance-*-glow, --stance-*-shadow, --inset-highlight). (3) Extracted CounterBadge and MeleeWinsTracker components, unified JoustAttackSelect/MeleeAttackSelect into single AttackSelectScreen. (4) Added keyboard arrow navigation for attack grids. (5) Added screen transition animations (fade-out/fade-in with prefers-reduced-motion). (6) Added 360px ultra-small breakpoint. (7) Consolidated 14 useState calls into useReducer with REMATCH reset action. Tests unchanged: 1430 tests, 24 suites. |
| S89 | React polish — design tokens + arrow nav + transitions. (1) Replaced all 26 remaining hardcoded rgba() in App.css with 19 new design tokens (gold-tint, red-tint, overlay, green/blue-tint, parchment-ghost). (2) Added arrow key navigation to speed selection grid (3-col). (3) Added arrow key navigation to reveal screen shift grid (2-col, 5 cards). (4) Fixed screen transition double-click bugs with transitioning guards on all 8+ handlers. (5) Extracted AI choice logic into pure computeJoustAI/computeMeleeAI helper functions. Tests unchanged: 1430 tests, 24 suites. |
| S90 | Operator P1 UX polish — toasts, agent cards, table filtering, report refresh. (1) Created shared app.js with progress bar, showToast(), global API toast listener. (2) Report auto-refresh every 15s. (3) Enriched agent cards with model/duration/cost/continuation badges via per-agent Map tracking. (4) Chain table filtering + sorting with hx-include params. (5) Replaced location.reload() with htmx.trigger() patterns. +7 tests → 1437 tests, 24 suites. |
| S91 | Operator P2 features — model override, report filter, branch auto-gen, PR auto-gen, auto-push. (1) Model tier dropdown in mission launcher (sonnet/opus/haiku) with --model CLI flag pass-through. (2) Report search filter with client-side tab filtering. (3) Branch auto-generation from task description with slugify helper. (4) PR body auto-generation from chain summary on completed chains. (5) Auto-push toggle on git panel with WS-driven push-on-completion. (6) Git push/PR endpoint tests + malformed request body tests. +19 tests → 1456 tests, 24 suites. |
| S92 | Operator P3 — multi-project dashboard, settings page, session output viewer, real-time chain progress, P4 test coverage. (1) Multi-project dashboard: nav project selector on all pages, htmx:configRequest global filter injection, cost-summary project filter. (2) Settings page: settings.mjs persistence with atomic writes + validation/clamping, GET/PUT API routes, settings.html form, applySettingsDefaults() pre-fills quick-start model. (3) Session output viewer: terminal.mjs ANSI-to-HTML converter with 16 color classes, renderTerminalViewer() replaces raw <pre> in session handoff view. (4) Real-time chain progress: WS-driven updates replace aggressive polling (5s→15-30s), chain:assumed-complete bridged, chain.html per-chain WS listener, dashboard debounced reload on chain:* events. (5) P4 test coverage: +26 tests — settings API (4), settings page (1), chain sort (2), terminal ANSI (5), terminal render (4), settings form view (1), cost-summary filter (2), chain list sort/filter (5), agent grid (2). +26 tests → 1482 tests, 24 suites. |
| S93 | Operator P5 — integration & core gaps. (1) Settings CLI integration: operator.mjs imports loadSettings(), parseArgs defaults removed so CLI flags can be distinguished from saved settings, merge priority: CLI > saved settings > hardcoded default. MODEL_MAP hoisted to module-level constant (eliminates 3 duplicates). (2) Combined mode --operator wiring: server.mjs imports runChain from operator.mjs, creates adapter wrapper bridging runChainFn(chain) → runChain(config, registry, chain). operator.mjs isMain guard prevents main() from running when imported. (3) Chain delete button: delete button (btn--delete) in chain-row.mjs for non-running chains, delete button on chain detail page, chain:deleted event emitted from DELETE handler + added to BRIDGED_EVENTS in ws.mjs. (4) Chain pagination: views.mjs chain-list accepts page/limit params, hx-swap-oob renders pagination controls outside tbody, hidden page input in #chain-filters, setPage() JS, page resets on sort/filter change, pagination CSS styles. (5) Empty state text fix: "Start one below!" → "Start one above!". +9 tests → 1491 tests, 24 suites. |
| S94 | Operator P6 — UI feature gaps. (1) Git commit UI: added commit message input + Commit button to git-status fragment when dirty (form POSTs to /api/git/commit), Push button alongside. (2) Chain text search: added ?q= query param filter in views.mjs chain-list (case-insensitive task text match), debounced search input in #chain-filters on index.html. (3) Chain detail branch display: added Branch field to chain-meta section when chain.config.branch is set. (4) Form submission loading states: CSS-based loading — .htmx-request disables submit buttons (opacity + pointer-events) and shows spinning border via ::after pseudo-element. (5) Auto-push server-side persistence: added autoPush boolean to settings.mjs DEFAULTS/loadSettings/saveSettings, git-status toggle renders checked from server, toggleAutoPush() PUTs to /api/settings instead of localStorage, WS auto-push listener fetches /api/settings, autoPush checkbox added to settings form. Tests unchanged: 1491 tests, 24 suites. |
| S95 | Operator P7 — polish & enhancements. (1) WS reconnection: created shared createWS() utility in app.js with exponential backoff (1s→2s→4s→…→30s max), refactored all 3 WS connection points (dashboard, chain detail, orchestrator log) to use it. (2) Keyboard shortcuts: N key opens/focuses new chain task input, / key focuses chain search input (both skip when inside form elements). (3) SVG favicon: two interlocking circles (chain links) in accent colors, added as data URI to all 4 HTML pages. (4) WS connection status indicator: small dot next to "Operator" brand in nav, green=connected/red=disconnected/yellow=connecting, driven by createWS trackStatus option. (5) Styled confirm dialog: HTML <dialog> element dynamically created in app.js, intercepts HTMX hx-confirm events globally via htmx:confirm listener, danger-styled buttons for delete/abort/stop actions, backdrop blur, click-outside-to-close. Tests unchanged: 1491 tests, 24 suites. |
| S96 | Operator P7 continued — 4 features. (1) Per-model cost breakdown: added byModel aggregation to GET /api/costs, cost summary view renders per-model metric cards (Opus/Sonnet/Haiku) with accent border and chain count subtitle, persisted inputTokens/outputTokens in session data model. (2) Chain export: GET /api/chains/export endpoint with ?format=csv|json, JSON/CSV download buttons on dashboard next to "Chains" title. (3) Bulk chain actions: checkbox column on chain table rows, select-all header checkbox with indeterminate state, bulk action bar with count + Delete Selected + Clear, POST /api/chains/batch-delete endpoint, styled confirm dialog for batch deletes. (4) Side-by-side handoff viewer: handoff-compare view fragment with session picker dropdowns, two-column grid layout rendering both handoffs via terminal viewer, auto-loads on chain detail page when 2+ handoffs exist, responsive single-column on mobile. Tests unchanged: 1491 tests, 24 suites. |
| S98 | Operator P8 Analytics Dashboard. New /analytics page with server-side SVG charts: 30-day daily cost bar chart, status breakdown donut, model usage horizontal bars, 6 metric cards (total cost, success rate, avg cost/chain, avg duration, total turns, total duration), top-10 chains by cost leaderboard. New operator/views/analytics.mjs (7 exported functions, ~280 lines). Analytics nav link added to all 5 HTML pages. CSS section 37 for chart styling. Zero new dependencies — all inline SVG via template literals. +22 tests → 1526 tests, 24 suites (server 94, views 112). |
| S97 | Operator P7 COMPLETE — final 2 features (theme toggle skipped per user). (1) Orchestrator run history: persisted to orch-history.json with atomic writes (max 50 entries), records start/stop events with mission, model, dryRun, rounds, agents, duration, outcome. GET /api/orchestrator/history endpoint + /views/orch-history HTMX fragment with table view, 30s polling + WS-triggered reload on orchestrator stop. (2) Chain dependency/lineage graph: added restartedFrom field to chain data model in createChain/getChainSummary, POST /api/chains/:id/restart now sets lineage link, getChainLineage() BFS walks ancestor→descendant tree. /views/chain-lineage/:id renders CSS tree with connector lines, current-chain highlighting, auto-loads on chain detail page. Added orch-history-table and lineage CSS styles. +13 tests → 1504 tests, 24 suites (server 92, views 92). |
| S100 | Operator P10 File Explorer Enhancement. (1) File content preview: click any file in tree to open fixed side panel with line numbers, GET /api/files/content endpoint with 100KB limit, binary detection, path-traversal guard. (2) Git status indicators: file tree entries show M/A/D/R/?/U color-coded badges, dirs show yellow dot for contained changes, "N changed" count in project stats. GET /api/git/file-status endpoint + getGitFileStatus() helper, fetched in parallel during panel render. (3) File search: search input per project card, client-side 150ms debounced filtering by filename, auto-opens matching dirs. (4) Collapsible project cards: toggle button to collapse/expand card body, state persisted in localStorage, restored after HTMX swap. CSS section 40. +35 tests → 1588 tests, 24 suites (server 106, views 162). |
| S101 | Project Review + Tier 1 Fixes. Ran 7-audit review (code-review, security-scan, orchestrator-status, performance, accessibility, dependency, test-coverage) via parallel agents. Created 4 new audit skills. Consolidated 105 findings into tiered action plan (docs/s101-project-review.md). Implemented all 6 Tier 1 critical fixes: (T1-1) restricted /api/files and /api/git/file-status root param to registry project dirs via getAllowedRoots callback, (T1-2) defined 9 missing CSS custom properties as aliases to existing tokens, (T1-3) added mtime-based registry cache with write-through invalidation, (T1-4) created file-watcher.test.mjs with 16 tests covering watch/unwatch/debounce/events, (T1-5) made file tree keyboard-accessible with tabindex+role+keydown handler, (T1-6) added aria-hidden/aria-label/aria-expanded/role=status across all view renderers and 6 HTML pages + .sr-only CSS class. +16 tests → 1604 tests, 25 suites. |
| S102 | Multi-Orchestrator Research & Planning. Sent 6 parallel research agents to investigate: multi-orchestrator architectures (Multiclaude, Claude Squad, Agent-MCP, ccswarm, Microsoft reference arch, Claude Code Agent Teams), skill pools & intelligent selection (two-stage: category filter → LLM ranking, JSON manifests, agent profiles), current project structure assessment (identified 6 singleton blockers), terminal UI (xterm.js via CDN, 4 color themes), handoff/continuation systems (Anthropic engineering blogs), Node.js IPC patterns (fork() IPC, EventBus bridge, proper-lockfile). Created master plan (docs/multi-orchestrator-plan.md) with 7 phases across ~9 sessions: Phase 0 singleton cleanup, Phase 1 process pool, Phase 2 multi-terminal UI, Phase 3 handoff workflow, Phase 4 skill pool, Phase 5 inter-orchestrator coordination, Phase 6 polish+scaling. Architecture: hybrid coordinator + autonomous workers, fork() IPC, git worktrees, xterm.js, 1 new dependency (proper-lockfile). |
| S103 | Phase 0: Foundation Cleanup. Converted registry.mjs from module-level singleton (initRegistry + mutable globals) to createRegistry(ctx) factory pattern returning {load, save} with path state in closure. Pure data functions (createChain, recordSession, etc.) remain standalone exports. Converted settings.mjs similarly (createSettings). Added proper-lockfile for cross-process file locking on registry save (lockSync/unlockSync, realpath:false for Windows). Extracted EventBus class from orchestrator/observability.mjs to shared/event-bus.mjs, created IPCEventBus subclass with process.send() forwarding. Updated all consumers: server.mjs creates instances in createApp(), routes destructure ctx.registry/ctx.settings, operator.mjs passes regStore to runChain(). Updated all 3 test files. All 1604 tests pass, 25 suites. Phase 0 complete — all 5 singleton blockers resolved. |
| S104 | Phase 1: Process Pool + Multi-Instance Backend. (1) Created operator/process-pool.mjs (~300 lines): createProcessPool(ctx) factory with spawn/kill/restart/sendTo/getStatus/getWorker/remove/shutdownAll/activeCount, fork() IPC, heartbeat checker (30s interval, 3 missed = restart), worker event re-emission on parent EventBus. (2) Created operator/orchestrator-worker.mjs: child process entry point with IPC protocol (init/start/stop/ping/shutdown), IPCEventBus integration, orchestrator fork management. (3) Refactored routes/orchestrator.mjs for multi-instance: instances Map with per-instance state + agent maps, new endpoints (GET /instances, POST /:id/start, POST /:id/stop, DELETE /:id), events routed by workerId, run history with instanceId, backward-compatible legacy endpoints. (4) Wired into server.mjs: pool option (true=auto-create, object=inject), pool passed to orch routes, shutdown cleanup, pool in return value. (5) Added 7 worker events to ws.mjs BRIDGED_EVENTS (24 total). +43 tests → 1647 tests, 26 suites (process-pool 43). |
| S105 | Handoff only — no implementation. Context ran out before Phase 2 work could begin. Generated handoff-s105.md with detailed Phase 2 Multi-Terminal UI spec (xterm.js, tab bar, 4 color themes, grid/tab views, WS event routing). Tests unchanged: 1647 tests, 26 suites. |
| S106 | Phase 2: Multi-Terminal UI + Plan Update. (1) Created operator/public/terminals.html: new page with xterm.js + xterm-addon-fit via CDN, tab bar, terminal panels, grid toggle button, new-instance dialog with mission/model/dryRun form. (2) Created operator/public/terminals.js (~470 lines): 4 color themes (Indigo/Emerald/Amber/Rose) with xterm.js theme objects, instance management (add/remove/start/stop), tab bar with color-coded dots, tab/grid view toggle (localStorage persisted), WS event routing by workerId (worker:*/orchestrator:*/agent:*/round:* events), keyboard shortcuts (Ctrl+1-4), auto-create tabs for new workers, status bars with round/agent count. (3) Added CSS section 41 in style.css: orchestrator color theme custom properties, tab bar, terminal panels (tab + grid modes), status bars, instance dialog, view toggle. (4) Added Terminals nav link to all 7 HTML pages. (5) Added GET /terminals route in server.mjs. (6) +10 tests: terminals page HTML/CDN/script/dialog tests + nav link verification on 5 pages. (7) Fixed Pico CSS blue background on project tree files (role="button" override), reduced file tree font size. (8) Updated multi-orchestrator-plan.md: added Phase 4 (General-Purpose Agent Roster) with 8 new roles (backend-dev, full-stack-dev, database-dev, docs-writer, debugger, refactorer, integration-tester, dependency-manager) and 6 mission templates (web-app, api-service, library, bugfix-sprint, refactor, full-team), renumbered Phases 5-7. 1657 tests, 26 suites. |
| S107 | Phase 3 Partial: Context Continuation + Model Routing + Project-to-Terminal. (1) Context continuation: orchestrator-worker.mjs accepts handoffFile in init/start IPC messages, passes --handoff-file CLI arg to forked orchestrator, process-pool.mjs forwards handoffFile in init + new pool.handoff() convenience method. (2) Created orchestrator/model-routing.mjs: MODEL_TIERS, ROLE_MODEL_MAP (16 roles across 3 tiers), resolveAgentModel() with user model ceiling. (3) Project-to-Terminal button: projects.mjs renders Terminal button on project cards, app.js openProjectInTerminal() stores dir in sessionStorage + navigates to /terminals. NOT applied: handoff API endpoints, handoff terminal UI, handoff CSS, model routing integration into orchestrator.mjs, terminals.js project-to-terminal handling. Agent specs ready in docs/handoff-s107.md. Tests unchanged: 1657 tests, 26 suites. |
| S108 | Post-S107 Bug Review & Fixes. Reviewed all S107 code for bugs introduced during compaction. Fixed 5 bugs: (1) model-routing resolveAgentModel() could return undefined/null for invalid userModel — normalized to sonnet fallback, (2) projects.mjs Terminal button XSS via single-quote injection in inline onclick — switched to data-dir attribute, (3) process-pool handoff() could send start to non-running workers — added running state check, (4) orchestrator-worker unused resolve import removed, (5) orchestrator-worker start handler missing projectDir null guard. Generated handoff-s108.md with detailed Phase 3 completion specs. Tests unchanged: 1657 tests, 26 suites. |
| S109 | Phase 3 Complete: Handoff API + UI + Model Routing. (A) Added 3 handoff API endpoints + generateHandoffDoc() helper in orchestrator routes: POST /:id/handoff (generate without restart), GET /:id/handoffs (list history), POST /:id/handoff-restart (generate + kill + respawn with context). (B) Added handoff:generated + handoff:restart to WS BRIDGED_EVENTS (26 total). (C) Added --model and --handoff-file= CLI parsing in orchestrator.mjs alongside --dry-run. (D) Wired resolveAgentModel() from model-routing.mjs into loadMission() agent model assignment with MODEL_OVERRIDE support. (E) Added handoff terminal UI: Handoff + History buttons in status bar, handoffInstance() with 5-step ANSI progress, showHandoffHistory() dropdown, WS handoff:* subscriptions, updateStatusBar() shows/hides handoff button based on running state. (F) Added project-to-terminal completion: checkPendingProject() reads sessionStorage, pre-fills dialog, submitNewInstance() includes projectDir. (G) Added CSS section 42: handoff-progress, step states, btn--accent, handoff-history dropdown. Created model-routing.test.mjs (12 tests) + 9 handoff API tests in server.test.mjs. 1678 tests, 27 suites. Phase 3 COMPLETE. |
| S110 | Phase 4 Complete: General-Purpose Agent Roster. (A) Created 8 new role templates in orchestrator/roles/: backend-dev, full-stack-dev, database-dev, docs-writer, debugger, refactorer, integration-tester, dependency-manager — each with identity, example tasks, restrictions, file ownership, standards. (B) Updated CODE_AGENT_ROLES (6→12), COORD_AGENT_ROLES (3→5), SPAWN_CONSTRAINTS.blockedRoles (3→5), ROLE_DEFAULTS (14→22). ROLE_MODEL_MAP already had all 8 from S107. (C) Created 6 general-purpose mission templates: web-app.json (10 agents), api-service.json (8), library.json (7), bugfix-sprint.json (6 with debugger×2), refactor.json (6), full-team.json (13 with maxConcurrency:4). Every mission has producer+tech-lead minimum, budgets scale with team size. (D) Created role-registry.test.mjs (67 tests): template loading for all 23 roles, ROLE_DEFAULTS metadata, category grouping, heuristic classification, buildAgentConfig, content validation. Expanded model-routing.test.mjs (+1 test for all 20 ROLE_MODEL_MAP entries). +68 tests → 1746 tests, 28 suites. Phase 4 COMPLETE. |
| S112 | Phase 6A Complete: Inter-Orchestrator Coordination Core. (A) Created 5 new modules in operator/coordination/: task-queue.mjs (DAG-based task queue with deps, priorities, worker assignment, cycle detection, cancel/retry/cascade), work-assigner.mjs (3 strategies — round-robin, capability-based, work-stealing — with auto task count refresh), rate-limiter.mjs (token bucket with per-minute refill, per-worker tracking, async acquire with waiters queue), cost-aggregator.mjs (cross-worker cost tracking, per-worker + global budget caps, WARNING_THRESHOLD 80%, events for warning/exceeded), coordinator.mjs (central broker — lifecycle init→running→draining→stopped, event routing for coord:request/complete/failed/rate-request/cost, auto-assign on task add). (B) Created coordination REST routes (operator/routes/coordination.mjs) — 13 endpoints: status, tasks CRUD+batch, cancel, retry, progress, lifecycle start/drain/stop, rate-limit, costs. (C) Added 9 new BRIDGED_EVENTS to ws.mjs (26→35): coord:started/stopped/draining/assigned/task-complete/task-failed/all-complete/budget-warning/budget-exceeded. (D) Wired coordinator into server.mjs: auto-creates when pool mode active, coordination:false opt-out, graceful shutdown, exposed in return value. (E) Created coordination.test.mjs with 136 tests across 5 describe blocks: TaskQueue (64 tests — add/remove/status transitions/cancel cascade/retry/getReady/getByWorker/DAG utils/serialization/cycle detection), WorkAssigner (20 tests — 3 strategies/assignAll/events/validation), RateLimiter (14 tests — tryAcquire/refill/deny/async acquire/processWaiters/reset), CostAggregator (17 tests — record/per-worker budget/global budget/checkBudget/events/reset), Coordinator (21 tests — creation/lifecycle/addTask/event handling/status/cleanup). +136 tests → 2115 tests, 31 suites. Phase 6A COMPLETE. |
| S114 | Phase 6C Complete: Integration Tests + Coordination UI. (A) Created coordination-aware dummy worker script (operator/__tests__/coord-dummy-worker.mjs) — handles init/ping/shutdown plus coord:proceed/wait/rate-grant/rate-wait/budget-stop, auto-complete mode and manual mode with test:* control messages. (B) Created end-to-end integration tests (operator/__tests__/coordination-integration.test.mjs, 22 tests) — 9 describe blocks: task lifecycle end-to-end (3 tests — assign/complete/multi-task/status transitions), task dependencies (2 — linear deps, diamond DAG), worker request flow (2 — proceed and wait responses), task failure + cascade (2 — failure marking, dependent cancellation), rate limiting through IPC (2 — grant and deny), cost tracking through IPC (3 — coord:cost recording, budget-stop on exceed, session:complete auto-bridging), multiple workers (3 — round-robin distribution, dependency unlock, per-worker cost tracking), coordinator lifecycle (2 — full lifecycle and getStatus), server integration (3 — coordinator creation, REST endpoints, batch tasks). All use real ProcessPool with real child processes. (C) Added coordination status UI to terminals page — terminals.js subscribes to coord:* events via WebSocket, new coordination bar below status bar (task progress bar, rate limit dot, cost meter, worktree badge), event handlers for coord:started/stopped/draining/assigned/task-complete/task-failed/all-complete/budget-warning/budget-exceeded/worktree-created/removed/merged/conflicts-detected. CSS for .term-coord* elements. Progress and cost fetched via REST API with debouncing. +22 tests → 2209 tests, 32 suites. Phase 6C COMPLETE. |
| S113 | Phase 6B Complete: Conflict Prevention. (A) Created operator/coordination/worktree-manager.mjs — per-worker git worktree isolation with factory pattern: create(workerId) creates worktree at .worktrees/{workerId}/ with branch worker-{workerId}, remove(workerId), merge(workerId) with conflict detection+abort, dryRunMerge(workerId) via git merge --no-commit --no-ff, detectConflicts() for all workers, cleanupAll() with git worktree prune. Injectable _gitExec for testing. Events: coord:worktree-created/removed/merged/conflicts-detected. (B) Added coord:* IPC handlers to orchestrator-worker.mjs — new handleCoordMessage() routes coordinator responses (coord:proceed/wait/rate-grant/rate-wait/budget-stop) to local IPCEventBus. Tracks currentTask and budgetExceeded state, included in sendStatus(). (C) Enhanced coordinator.mjs with rate limiter periodic tick (processWaiters() every 5s via setInterval, configurable rateLimiterTickMs, stopped on coordinator stop). (D) Added session cost auto-bridging — coordinator listens for session:complete events and auto-records costs to aggregator via shared recordCostAndCheck() helper. Enabled by default, opt-out with autoRecordSessionCosts:false. (E) Wired worktreeManager into coordinator as injectable subsystem, exposed in return value and getStatus(). (F) Added 4 worktree events to ws.mjs BRIDGED_EVENTS (35→39). (G) 72 new tests in coordination.test.mjs: WorktreeManager (31 — creation/create/remove/get-has/dryRunMerge/merge/detectConflicts/cleanupAll/getStatus/exports), Worker Coord IPC (6), Coordinator Rate Limiter Integration (4), Coordinator Cost Aggregator Integration (7), Session Cost Auto-Bridging (7), Coordinator Worktree Integration (4), Rate Limiter Tick (3). +72 tests → 2187 tests, 31 suites. Phase 6B COMPLETE. |
| S115 | Phase 7a: UX Polish. (A) Keyboard shortcuts for terminals page — 10 shortcuts: Ctrl+1-4 (tab switch, existing), Ctrl+N (new instance), Ctrl+W (close terminal), Ctrl+H (handoff), Ctrl+F (search), Ctrl+Shift+Left/Right (navigate tabs), Ctrl+Shift+G (toggle grid/tab), Ctrl+Shift+M (maximize/restore), Escape (close dialogs/search). Added ? button with shortcuts help dialog. (B) Terminal search via xterm.js SearchAddon — Ctrl+F opens search bar per terminal, Enter/Shift+Enter for next/prev match, live search on input, Escape to close. Search bar UI with input, nav buttons, close button. (C) Grid panel maximize/restore — maximize button per panel in status bar, Ctrl+Shift+M shortcut, maximized panel fills entire 2x2 grid, others hidden, restore returns to 2x2. (D) Dashboard orchestrator summary — new /views/orch-summary HTMX fragment, shows running/total instance cards with status dots, mission, model, round, cost, links to /terminals. Coordination progress bar when coordinator active. Auto-refreshes every 10s, only visible when instances exist. (E) Loading states + error recovery — skeleton spinner during instance fetch, button loading states (start/stop with spinner), WS disconnect overlay with reconnect indicator on terminal panels, createWS onConnect/onDisconnect callbacks. (F) 3 new view tests for orch-summary (empty, no pool, with instances). +3 tests → 2212 tests, 32 suites. Phase 7a partially COMPLETE. |
| S116 | Phase 7b Partial: Scaling + Robustness. (A) Enhanced process-pool.mjs with 5 new robustness features: circuit breaker (consecutive failure tracking, open/half-open/closed states, configurable threshold+cooldown, worker:circuit-open/half-open events), idle kill (lastActivity tracking on IPC events, idle timeout check in heartbeat loop, worker:idle-killed event), crash recovery improvements (maxRestarts cap, exponential backoff 1s→60s, clean exit vs crash distinction, worker:max-restarts event), per-worker status fields (lastActivity, consecutiveFailures, circuitState). 6 new configurable options. (B) Enhanced coordinator.mjs with auto-scale (minWorkers/maxWorkers/scaleUpThreshold, periodic check + on-add-task check, workerConfigFactory for auto-spawned workers, coord:scale-up event), budget auto-drain (global budget exceeded → auto-drain, configurable budgetAutoDrain), drain timeout (configurable drainTimeoutMs, force-stop on deadline, coord:drain-timeout event). (C) Fixed orchestrator-worker.mjs budget-stop enforcement — now actually stops orchestrator on coord:budget-stop, reports currentTask as coord:failed, clears stale currentTask on orchestrator exit. (D) Added 6 new events to ws.mjs BRIDGED_EVENTS (39→45): worker:idle-killed/circuit-open/circuit-half-open/max-restarts + coord:scale-up/drain-timeout. (E) +22 tests: circuit breaker (5), idle kill (3), backoff math (1), auto-scale (4), budget drain (2), drain timeout (2), stress tests with real processes (5 — 4-worker distribution, task deps, budget enforcement, circuit breaker, status fields). 2234 tests, 32 suites, all passing. |
| S117 | Phase 7b Complete: Persistent Queue. (A) Created operator/coordination/persistent-queue.mjs — `createPersistentQueue({filePath})` wraps createTaskQueue() with atomic disk persistence using registry.mjs pattern (write-to-tmp, rename, lockfile). Auto-saves on meaningful mutations (add/complete/fail/cancel/retry/remove/clear), skips intermediate states (assign/start) since they reset on recovery. Load recovers from .tmp if primary is missing/corrupt, resets in-flight tasks (assigned/running → pending) since workers are gone after restart. (B) Enhanced coordinator.mjs — new `persistPath` option creates persistent queue internally, loads from disk on start() with coord:queue-loaded event, final save on stop(). (C) Added coord:queue-loaded to ws.mjs BRIDGED_EVENTS (45→46). (D) +27 tests in coordination.test.mjs: PersistentQueue (20 — filePath validation, API parity, auto-save per mutation, no-save on assign/start, load from disk, in-flight reset, no-file handling, .tmp crash recovery, corrupt file fallback, round-trip with deps/priorities/metadata, multiple save/load cycles, read-through methods) + Coordinator with PersistentQueue (7 — persistent queue creation, regular queue fallback, load on start, in-flight reset on start, no-file no-event, lifecycle persistence, completed state persistence). 2261 tests, 32 suites, all passing. Phase 7b COMPLETE. |
| S118 | Phase 8: Worker Health Dashboard + Orchestrator Config Panel. (A) Added GET /api/orchestrator/workers/health endpoint to routes/orchestrator.mjs — returns per-worker health data from pool.getStatus() (circuit breaker state, consecutive failures, restart count, last heartbeat, last activity, PID, config). Returns poolActive:false when no pool. (B) Added POST /api/orchestrator/:id/config endpoint — updates instance model/maxBudgetUsd/maxTurns in local state, forwards IPC config message to running worker via pool.sendTo(). (C) Added collapsible Worker Health panel to terminals.html — `<details>` element above tab bar with badge showing worker count. Health cards show per-worker: status dot (running/starting/stopping/stopped), circuit breaker badge (closed/half-open/open with semantic colors), failure count, restart count, heartbeat age, activity age. Auto-refreshes every 10s when panel is open. Updates reactively from WS events (worker:spawned/ready/exit/circuit-open/circuit-half-open/max-restarts/idle-killed/restarted). (D) Added config dialog to terminals.html — modal with model select, budget input, max turns input. Accessible via gear icon button in terminal status bar. Submits to config endpoint, shows confirmation in terminal. (E) Added CSS for health panel (section 43) — card grid with status dots, circuit breaker badges, stat labels. Also added shortcuts dialog grid styles (section 44). (F) Enhanced WS event handling in terminals.js — worker:idle-killed, worker:circuit-open, worker:circuit-half-open, worker:max-restarts events now logged to terminal with ANSI formatting and update health cards. (G) +10 tests in server.test.mjs: health endpoint no-pool (1), health endpoint with mock pool (1), config 404 (1), config model update (1), config budget+turns (1), config persistence via instances (1), config IPC forwarding (1), terminals HTML health panel (1), terminals HTML config dialog (1), terminals.js health functions (1). 2271 tests, 32 suites, all passing. |
| S119 | Phase 9: Config IPC Wiring + Hot-Reconfiguration + Task Metrics. (A) Wired config IPC handler in orchestrator-worker.mjs — added `case 'config':` to handleMessage switch. Merges model/maxBudgetUsd/maxTurns into worker config state. Forwards config to running orchProcess via IPC. Emits worker:config-applied event via IPCEventBus. Updated IPC protocol doc comment. (B) Added updateConfig(workerId, configUpdate) to process-pool.mjs — merges new config into entry.config so getStatus()/health endpoints reflect latest runtime config. (C) Updated POST /api/orchestrator/:id/config in routes/orchestrator.mjs to call pool.updateConfig() alongside sendTo(), keeping pool-level config in sync. (D) Added hot-reconfiguration to coordinator subsystems: rate-limiter.mjs updateLimits() — updates maxRequestsPerMinute/maxTokensPerMinute at runtime, caps buckets to new max. cost-aggregator.mjs updateBudgets() — updates globalBudgetUsd/perWorkerBudgetUsd at runtime, resets exceeded/warning flags when budget raised above current totals. coordinator.mjs updateOptions() — delegates to subsystem update methods, emits coord:config-updated event. (E) Added task metrics collection to coordinator — tracks completions/failures in 5-minute sliding window. getMetrics() returns throughputPerMinute, avgCompletionMs, workerUtilization, recentCompletions/Failures, outcome counts. (F) Added REST endpoints in coordination routes: GET /api/coordination/metrics, POST /api/coordination/config. (G) +25 tests: coordination.test.mjs +21 (RateLimiter updateLimits 4, CostAggregator updateBudgets 4, Coordinator updateOptions 4, Coordinator getMetrics 5, Worker Config IPC Handler 2, Process Pool updateConfig 2), server.test.mjs +4 (pool config update 1, metrics endpoint 1, config endpoint 1, 503 without coordinator 1). 2296 tests, 32 suites, all passing. |
| S120 | Phase 10: Metrics Dashboard + Coordination Config UI + Orch Config Handler. (A) Added IPC config handler to orchestrator.mjs — `process.on('message', ...)` handler (guarded by `typeof process.send === 'function'`) receives `{ type: 'config', model?, maxBudgetUsd?, maxTurns? }` from orchestrator-worker. Mutates CONFIG.maxAgentChainCostUsd, CONFIG.maxAgentTurns directly (initAgentRunner holds reference). Updates MODEL_OVERRIDE (changed from const→let). Completes full IPC chain: UI → REST → pool → worker → orchestrator. (B) Added Coordination Metrics panel to terminals.html — collapsible `<details>` between health panel and tab bar. Shows 6 metric cards: throughput/min, avg completion time, utilization (with progress bar), completed count, failed count, pending/running. State badge shows coordinator lifecycle (running/draining/stopped). Auto-refreshes every 10s when open. Fetches from GET /api/coordination/metrics + /api/coordination/status. (C) Added Coordination Config dialog to terminals.html — modal with rate limit (RPM, TPM) and budget (global, per-worker) fields. Pre-fills from GET /api/coordination/rate-limit + /api/coordination/costs. Submits to POST /api/coordination/config. (D) Added coord:config-updated to ws.mjs BRIDGED_EVENTS (46→47). terminals.js handles event to auto-refresh metrics panel. (E) Added CSS section 45 for metrics panel — follows health panel BEM pattern, uses design tokens, includes utilization bar, value color variants. (F) +6 tests: server.test.mjs +4 (terminals metrics panel HTML, coord config dialog HTML, terminals.js metrics functions, style.css metrics styles), coordination.test.mjs +2 (bridged events includes coord:config-updated, coordinator emits config-updated on updateOptions). 2302 tests, 32 suites, all passing. |
| S121 | Phase 11: Adaptive Rate Limiting. (A) Created operator/coordination/adaptive-limiter.mjs — `createAdaptiveLimiter({rateLimiter, events, ...})` factory wrapping existing rate limiter. Tracks 429 errors in sliding window. States: normal → backing-off → recovering → normal. On error threshold breach, reduces limits by backoff factor (0.5^level). Exponential backoff up to maxBackoffLevel (4). Automatic recovery via interval timer that gradually restores limits using recoveryFactor (1.5×). Floors: min 1 req/min, 1000 tok/min. updateBaseline() syncs with user config changes. (B) Integrated into coordinator.mjs — new coord:rate-error handler feeds adaptive limiter. updateOptions() syncs adaptive baseline. adaptiveLimiter exposed on coordinator return object. Cleanup in stop(). 7 new config options (enableAdaptiveRate, adaptiveErrorThreshold, adaptiveWindowMs, adaptiveBackoffFactor, adaptiveMaxBackoffLevel, adaptiveRecoveryIntervalMs). (C) Added GET /api/coordination/adaptive-rate route to coordination routes. (D) Added coord:rate-adjusted to ws.mjs BRIDGED_EVENTS (47→48). (E) Added Rate Limit card to terminals.html metrics grid — shows current limit as % of baseline with color coding (green/warn/danger), adaptive state badge (normal/backing-off/recovering). CSS: adaptive badge styles with backing-off (red) and recovering (amber) variants, warn/danger value colors. terminals.js: updateAdaptiveCard() function, fetches /api/coordination/adaptive-rate on metrics refresh, handles coord:rate-adjusted WS event for instant UI updates. (F) +26 tests: coordination.test.mjs +23 (AdaptiveLimiter 16: state/threshold/backoff/emit/deepen/max/recover/restore/baseline/reset/states/floor/prune, Coordinator+AdaptiveLimiter 6: default creation/disable/rate-error/baseline-update/event-emit/no-workerId, WS bridged events 1), server.test.mjs +3 (adaptive rate card HTML, adaptive rate JS functions, adaptive badge CSS styles). 2328 tests, 32 suites, all passing. |
| S122 | Phase 12: Task Board UI. (A) Created operator/public/taskboard.html — new Kanban board page with 5 status columns (Pending, Assigned, Running, Complete, Failed). Includes add task dialog (id, description, priority, category, deps fields), progress bar with completion tracking, coordinator status badge. Standard nav with active "Tasks" link. (B) Created operator/public/taskboard.js — client-side Kanban logic. Fetches tasks from GET /api/coordination/tasks. Renders task cards with ID, description, priority badge (high/med/low), worker assignment, category, dependency count, relative timestamps, error display. Drag-and-drop: drag to Failed column = cancel, drag from Failed to Pending = retry. Action buttons: cancel (×) and retry (↻) on hover. WebSocket real-time updates: coord:assigned moves cards, coord:task-complete/task-failed update instantly, coord:all-complete triggers reload. Add task form with validation. 10s polling + WS for live updates. (C) Added task board CSS section (47) to style.css — full BEM styling: .task-board (flex column layout), .task-board__column (header + cards), .task-card (grab cursor, priority badges, action buttons on hover, cancelled strikethrough), .task-board__progress (bar + text), .task-board__dialog (modal form), .task-board__status (state badge), drop target highlight, drag opacity. (D) Added /taskboard route to server.mjs. (E) Added "Tasks" nav link to all 7 existing HTML pages (index, analytics, projects, orchestrator, terminals, chain, settings) + taskboard.html. (F) +14 tests in server.test.mjs: taskboard HTML serves (board columns, add dialog, progress bar, status badge, script tag), taskboard.js content (key functions, API endpoints, WS events), style.css content (board styles, card actions, priority badges), nav link presence across all pages, column dot elements. 2342 tests, 32 suites, all passing. |
| S123 | Phase 13: Task Board Enhancements. (A) Added taskQueue.update(id, fields) to task-queue.mjs — updates mutable fields (task, priority, category, metadata) on pending/assigned tasks. Returns updated task copy. Added 'update' to persistent-queue SAVE_METHODS for disk persistence. (B) Added PATCH /api/coordination/tasks/:id route to coordination.mjs — calls taskQueue.update(), returns updated task or 400 on error. 17th coordination endpoint. (C) Added filter/search bar to taskboard.html — text search input (matches id, description, category, worker), status dropdown (all/pending/assigned/running/complete/failed/cancelled), priority dropdown (high/med/low/none), dynamic category dropdown (auto-populated from task data), filter count indicator. Client-side filtering in taskboard.js via matchesFilter() + getFilteredTasks(). (D) Added keyboard shortcuts to taskboard.js — following terminals.js pattern: ? (help dialog), / (focus search), n (new task), Escape (close dialogs/clear search), 1-5 (scroll to column), a (select all), d (deselect), r (refresh). Shortcuts help dialog in taskboard.html with key table. Skip form fields guard. (E) Added task detail/edit dialog — click any card to open modal showing all task fields (id, status, worker, deps, timestamps, result, error). Editable form (description, priority, category) shown for pending/assigned tasks. Save button triggers PATCH API. (F) Added batch select and batch operations — checkbox on each card (visible on hover/selected), batch action bar (select all, clear, cancel selected, retry selected), task-card--selected visual state. (G) Added CSS section 48 in style.css — filter bar (.task-board__filters, search, dropdowns), batch bar (animated fade-in, accent border, cancel/retry colored buttons), card selection (.task-card--selected with accent border+glow, checkbox opacity transition), detail dialog (.task-board__detail-field layout, mono ID, error color), shortcuts dialog (.task-board__key styled keys, shortcuts table). (H) +24 tests: coordination.test.mjs +10 (update: pending desc, priority, category, metadata merge, assigned ok, running/complete/failed/unknown throws, empty category clears), server.test.mjs +14 (filter bar HTML, batch bar HTML, detail dialog HTML, shortcuts dialog HTML, JS filter functions, JS keyboard handler, JS detail/edit functions, JS batch functions, JS checkbox rendering, CSS filter bar styles, CSS batch+selection styles, CSS detail+shortcuts styles, task-queue update method exists, update modifies fields). 2366 tests, 32 suites, all passing. |
| S111 | Phase 5 Complete: Skill Pool System. **Phase 5A** (2b139ca): (1) Created skill manifest JSON Schema (operator/skills/schema/skill.schema.json) — 7 categories, kebab-case IDs, semver versions. (2) Created 17 skill manifests in operator/skills/manifests/ (git/3, code/3, research/3, audit/8) — converted all 9 existing .claude/skills/. (3) Created SkillRegistry class (operator/skills/registry.mjs) — load from disk, validate, index by id/tags/category, search by keyword/category/tags/sideEffects/idempotent, helpers for write/readOnly/confirmation/deps/conflicts/enhancements. (4) Created skill resolver (operator/skills/resolver.mjs) — resolveSkillSet() depth-first dependency walk, checkCompatibility(), topologicalSort(). (5) Created skill selector (operator/skills/selector.mjs) — selectSkills() two-stage pipeline (category detection + token scoring), 6 AGENT_PROFILES (code-writer, reviewer, deployer, researcher, auditor, tester), selectProfileSkills(). +158 tests in skills.test.mjs. **Phase 5B** (c2a377e): (6) Created skill tracker (operator/skills/tracker.mjs) — createSkillTracker() factory with recordAssignment/recordUsage/recordUsageBatch, getUsageStats() aggregate analytics (overAssigned rate<0.2, highDemand rate>0.8), suggestAdjustments() prune/promote per lookback window. (7) Created skill discovery (operator/skills/discovery.mjs) — file-based mid-task protocol (discover-{agentId}-{suffix}.json), detectSkillRequests(), processSkillRequest() with conflict checking, archiveSkillRequest(), generateDiscoveryPrompt(). (8) Created skill assignment (operator/skills/assignment.mjs) — ROLE_PROFILE_MAP (22+ role→profile mappings), detectProfile() with auto-detection fallback, assignSkillsToAgent() (role→profile→core skills→task-specific→resolve deps→cap at maxSkills), reassignSkills() per-turn re-evaluation. +75 tests in skills-5b.test.mjs. Total: +233 tests → 1979 tests, 30 suites. Phase 5 COMPLETE. |
